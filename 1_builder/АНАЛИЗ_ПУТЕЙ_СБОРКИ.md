# Анализ путей сборщика: исходники → результат

## Текущая структура проекта

- **1_builder** — код сборщика
- **2_source** — исходные данные (конфиги, HTML-шаблоны, JS, img, bd, php)
- **3_result** — ожидаемый результат сборки (HTML-страницы, CSS, JS, секции и т.д.)

---

## Критические ошибки в путях

### 1. `build.py` — неверные пути

| Переменная   | Сейчас в коде                    | Фактически нужно              |
|-------------|-----------------------------------|-------------------------------|
| `source_dir` | `project_root / 'sourse'`        | `project_root / '2_source'`   |
| `output_dir`| `diskokras_dir / ':var:www:html' / 'diskokras'` | `project_root / '3_result'` |

**Проблемы:**

- Опечатка: **`sourse`** вместо **`source`**, а в проекте папка называется **`2_source`**.
- Результат сборки указывает на **`:var:www:html/diskokras`** (похоже на старый путь деплоя), а не на **`3_result`**.

**Следствие:** при запуске `python build.py` из `1_builder`:

- Исходники берутся из несуществующей `build_diskokras/sourse` → загрузка конфигов падает или пустая.
- Результат пишется в `.../products/:var:www:html/diskokras` → не в `3_result`, плюс возможны ошибки из-за `:` в пути.

---

### 2. Другие файлы с теми же условными путями

Во всех перечисленных местах используется **`sourse`** и/или **`:var:www:html/diskokras`** вместо **`2_source`** и **`3_result`**:

| Файл | Что не так |
|------|------------|
| `utils/path_utils.py` | `source_dir = diskokras_dir / 'sourse'`, `output_dir = ... / ':var:www:html' / 'diskokras'` |
| `utils/style_validator.py` | `source_dir = build_dir.parent / 'sourse'`, `output_dir = ... / ':var:www:html' / 'diskokras'`, захардкожен путь к CSS |
| `css/layout/default.py` | При `source_dir is None`: `source_dir = ... / 'sourse'` (в 4 местах) |
| `test_api_scripts.py` | `source_dir = project_root / 'sourse'` |
| `generators/css_generator.py` | В комментарии: «директория sourse» |

Итого: сборщик нигде не привязан к реальным папкам **2_source** и **3_result**.

---

## Соответствие ConfigLoader и 2_source

ConfigLoader ожидает под директорией исходников такую структуру:

| Ожидаемый путь от source_dir | В 2_source | Статус |
|------------------------------|------------|--------|
| `general/pages.json`         | есть       | OK     |
| `general/objects.json`       | есть       | OK     |
| `layout/layout_html.json`    | есть       | OK     |
| `layout/layout_col.json`     | есть       | OK     |
| `design/layout_css.json`     | есть       | OK     |
| `design/objects_css.json`    | есть       | OK     |
| `design/objects_fun.json`    | есть       | OK     |
| `design/html.json`           | есть       | OK     |
| `library/icon.json`          | есть       | OK     |
| `library/if.json`            | есть       | OK     |
| `library/color.css`          | есть       | OK     |
| `default/general.json`       | есть       | OK     |
| `default/div_column.json`    | есть       | OK     |
| `default/tag.json`           | есть       | OK     |
| `default_report/general.json`| папка называется **`default_report*`** | не совпадает |
| `default_report/tag.json`    | то же      | не совпадает |
| `default_report/objects_css.json` | то же  | не совпадает |
| `css/default.json`           | папки **`css/`** в 2_source нет | нет |
| `config.json` (в корне source) | в 2_source нет | нет (load_json_safe даёт {}) |

Итого по 2_source:

- Большая часть конфигов (general, layout, design, default, library) — на месте.
- **default_report**: в файловой системе папка **`default_report*`** (со звёздочкой), в коде — **`default_report`**. Нужна либо одна из двух правок: переименовать папку в `default_report` или в ConfigLoader искать папку по маске (например, `default_report*`).
- **css/default.json**: в 2_source нет `css/` — либо добавить папку и файл, либо в коде использовать другой путь (например, из `default/` или `design/`), в зависимости от задумки.
- **config.json**: опционален (есть дефолты), но для явных настроек сборки его стоит добавить в 2_source или загружать из другого места.

---

## Рекомендуемые исправления

### 1. Привести пути к 2_source и 3_result

В **build.py** (и при необходимости в **path_utils**, **style_validator**, **default.py**, **test_api_scripts**) заменить:

- исходники: **`sourse`** → **`2_source`** (или одна переменная `SOURCE_DIR_NAME = '2_source'`);
- результат: вычисление через **`:var:www:html/diskokras`** заменить на **`project_root / '3_result'`**.

После этого:

- Сборщик будет читать из **2_source**.
- Результат сборки будет попадать в **3_result**.

### 2. default_report*

- Вариант А: переименовать папку **`default_report*`** в **`default_report`** в 2_source.
- Вариант Б: в ConfigLoader (и везде, где есть путь `default_report`) искать директорию по шаблону `default_report*` (например, через `Path.glob` или `file_ignore`) и использовать её.

### 3. css/default.json

- Либо добавить в 2_source папку **`css/`** и файл **`default.json`** с нужными стилями.
- Либо изменить логику в **config_loader** и **css/layout/default.py**: не требовать `source_dir / 'css' / 'default.json'`, а брать настройки из существующей структуры (например, `default/` или отдельный файл в `design/`).

### 4. config.json

- Либо добавить **config.json** в корень 2_source с настройками сборки.
- Либо оставить текущее поведение (пустой конфиг и дефолты в коде), если этого достаточно.

---

## Краткий вывод

- Сборщик **сейчас обращается не к тем путям**: исходники — к несуществующей `sourse`, результат — к `:var:www:html/diskokras`, а не к **3_result**.
- После исправления путей на **2_source** и **3_result** обращение к исходникам и результат станут правильными.
- Дополнительно нужно согласовать с 2_source: имя папки **default_report** / **default_report***, наличие **css/default.json** и опционально **config.json**.
