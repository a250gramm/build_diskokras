<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Куда уходят данные формы form_form2</title>
    <style>
        body { font-family: sans-serif; padding: 1rem; max-width: 1200px; margin: 0 auto; }
        h1 { font-size: 1.25rem; }
        .table-wrap { overflow-x: auto; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ccc; padding: 0.5rem 0.75rem; text-align: left; }
        th { background: #f0f0f0; }
        .cell-source { font-size: 0.75rem; color: #666; margin-top: 0.25rem; }
        .cell-source code { background: #eee; padding: 0.1rem 0.3rem; border-radius: 3px; }
        .meta { margin-bottom: 1rem; color: #444; font-size: 0.9rem; }
    </style>
</head>
<body>
    <h1>Таблица назначения: order_shino</h1>
    <p class="meta">Одна строка = один заказ. В ячейках указано, из какого поля формы приходит значение.</p>
    <div class="table-wrap">
        <table id="target-table">
            <thead>
                <tr id="header-row"></tr>
            </thead>
            <tbody>
                <tr id="mapping-row"></tr>
            </tbody>
        </table>
    </div>
    <script>
        const targetTables = {
            "order_shino": {
                "title": "Заказ шиномонтажа",
                "columns": [
                    { "id": "shinomontazh", "title": "Шиномонтаж", "type": "number", "unit": "тг." },
                    { "id": "prokat", "title": "Прокат", "type": "number", "unit": "тг." },
                    { "id": "soski", "title": "Соски", "type": "number", "unit": "тг." },
                    { "id": "argon", "title": "Аргон", "type": "number", "unit": "тг." },
                    { "id": "prokat_2_1", "title": "Прокат (1)", "type": "number", "unit": "тг." },
                    { "id": "prokat_2_2", "title": "Прокат (2)", "type": "number", "unit": "тг." },
                    { "id": "total", "title": "Итого", "type": "number", "unit": "тг." },
                    { "id": "id_pay_met", "title": "Способ оплаты", "type": "string" }
                ]
            }
        };
        const formSubmitMap = {
            "form_form2": {
                "target_table": "order_shino",
                "target_url": "/api/order_shino",
                "method": "POST",
                "map": {
                    "1.div_wr-fields.1.div_field-price.field": "shinomontazh",
                    "1.div_wr-fields.2.div_field-price.field": "prokat",
                    "1.div_wr-fields.3.div_field-price.field": "soski",
                    "1.div_wr-fields.4.div_field-price.field": "argon",
                    "1.div_wr-fields.5.div_field-price.field": "prokat_2_1",
                    "1.div_wr-fields.5.div_field-price.field_2": "prokat_2_2",
                    "1.div_wr-fields.6.div_field-price.label": "total",
                    "pay_method": "id_pay_met"
                }
            }
        };

        const tableId = formSubmitMap.form_form2.target_table;
        const table = targetTables[tableId];
        const map = formSubmitMap.form_form2.map;
        const colIdToField = {};
        for (const [field, colId] of Object.entries(map)) {
            colIdToField[colId] = field;
        }

        const thead = document.getElementById('header-row');
        const tbody = document.getElementById('mapping-row');
        table.columns.forEach(col => {
            const th = document.createElement('th');
            th.textContent = col.title + (col.unit ? ', ' + col.unit : '');
            thead.appendChild(th);

            const td = document.createElement('td');
            const src = colIdToField[col.id];
            td.innerHTML = src ? `<span class="cell-source">← <code>${src}</code></span>` : '—';
            tbody.appendChild(td);
        });
    </script>
</body>
</html>
